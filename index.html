<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>space invaders</title>
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">

    <script src="./main.js" defer></script>
    <script src="./scripts/menu.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div id="menu" class="menu activated">
        <div id="main-menu" class="main-menu flex activated">
            <button onclick="play(); jogoInicio()" class="btn-temp-1">iniciar</button>
            <button onclick="multiplayerMenu()" class="btn-temp-1">multiplayer</button>
        </div>
        <div id="multiplayer-menu" class="multiplayer-menu flex disable">
            <button onclick="show_rooms()" class="btn-temp-1">join</button>
            <button onclick="online()" class="btn-temp-1">host</button>
            <button onclick="backToMenu()" class="btn-temp-1">back</button>
        </div>
        <div id="multiplayer-rooms" class="multiplayer-rooms flex disable">
            
            <button onclick="backToMultiplayerMenu()">back</button>
        </div>
    </div>
    <main id="canvas" class="canvas disable">
        <div class="hud">
            <p class="pontos">Pontos:</p>
            <button class="btn-pause" class="btn-temp-1"><img src="./assets/svg/pause_icon.svg" alt="pause icon"></button>
        </div>
    </main>
    <script>
        const ws = new WebSocket("ws://localhost:3000")
        function online() {
            let username = localStorage.getItem("username")
            if (true) {
                username = prompt("Seu username: ")
                localStorage.setItem("username", username)
            }

            ws.send(JSON.stringify({
                type: "new_player",
                username: localStorage.getItem("username")
            }));

            ws.send(JSON.stringify({
                type: "new_room"
            }));

            hostGame()
            jogoInicio()
        }

        function show_rooms() {
            join()
            ws.send(JSON.stringify({
                type: "view_rooms"
            }));
            
        }

        function enter_room(id) {
            ws.send(JSON.stringify({
                type: "enter_room",
                room_id: id
            }));


            play()
            var canhao = new Image();
            spawn_canhao(canhao, "player_2")
            jogoInicio()
        }

        window.addEventListener('keydown',(e)=>{
            if (e.key == 'ArrowRight' || e.key == 'd') {
                let player = document.getElementById("player")
                ws.send(JSON.stringify({
                    type: "player_position",
                    position: `${parseInt(player.style.left) + 10}px`
                }))
            } else if (e.key == 'ArrowLeft' || e.key == 'a'){
                let player = document.getElementById("player")
                ws.send(JSON.stringify({
                    type: "player_position",
                    position: `${parseInt(player.style.left) - 10}px`
                }))
            }else if(e.key == ' '){
                
            };
        })

        ws.onmessage = (message) => {
            let Message = JSON.parse(message.data)
            console.log(Message)
            if (Message.type == "view_rooms") {
                let rooms = document.getElementById("multiplayer-rooms")
                Message.rooms.forEach((room) => {
                    let Room = document.createElement('button')
                    Room.className = "btn-temp-2"
                    Room.innerText = room.name
                    Room.id = room.room_id
                    Room.onclick = () => enter_room(room.room_id)
                    rooms.appendChild(Room)
                });
            }

            if (Message.type == "enter_room") {
                var canhao = new Image();
                spawn_canhao(canhao, "player_2")
            }

            if (Message.type == "player_position") {
                let player_2 = document.getElementById("player_2")
                player_2.style.left = Message.position_x
                console.log(player_2.style.left)
            }
        }

    </script>
</body>
</html>